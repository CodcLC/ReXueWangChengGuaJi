
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/PetMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '8e6b1rTuI5Lya26ta8GZEUI', 'PetMgr');
// scripts/PetMgr.js

"use strict";

var t = require;
var e = module;
var o = exports;
Object.defineProperty(o, "__esModule", {
  value: !0
});

var a = t("Utils"),
    i = t("TrackDataEvent"),
    r = t("PlayerMgr"),
    n = t("TimeMgr"),
    s = function () {
  function t() {
    this.isOwnedPet = !1, this.twenMap = new Map(), this.moveSpeedPet = 150, this.enterPosX = -1e3, this.leftPosX = -250, this.rightPosX = 250, this.idleTime = 3;
  }

  return t.getInstance = function () {
    return null == this.instance && (this.instance = new t()), this.instance;
  }, t.prototype.initPetData = function () {
    r.PlayerMgr.getInstance().geUserData().isExistPetFotId(1) && (this.isOwnedPet = !0);
  }, t.prototype.getTween = function (t) {
    this.twenMap.has(t.uuid) && this.stopTween(t);
    var e = cc.tween(t);
    return this.twenMap.set(t.uuid, e), e;
  }, t.prototype.stopTween = function (t) {
    this.twenMap.has(t.uuid) && (this.twenMap.get(t.uuid).stop(), this.twenMap["delete"](t.uuid));
  }, t.prototype.petEnterAnim = function (t) {
    var e = this;

    if (cc.isValid(t)) {
      var o = Math.abs(t.x - this.leftPosX);
      t.getChildByName("pet").getComponent(sp.Skeleton).setAnimation(0, "move", !0), this.getTween(t).to(o / this.moveSpeedPet, {
        x: this.leftPosX
      }).call(function () {
        r.PlayerMgr.getInstance().getTrackData().youmengTrack(i.TrackId.pet_appear), e.petIdleAnim(t);
      }).start();
    }
  }, t.prototype.petGoOutAnim = function (t) {
    var e = this;

    if (cc.isValid(t)) {
      t.zIndex = 0, t.scaleX = 1;
      var o = Math.abs(t.x - this.enterPosX);
      t.getChildByName("pet").getComponent(sp.Skeleton).setAnimation(0, "move", !0), this.getTween(t).to(o / this.moveSpeedPet, {
        x: this.enterPosX
      }).call(function () {
        e.petIdleAnim(t);
      }).start();
    }
  }, t.prototype.petIdleAnim = function (t) {
    var e = this;

    if (cc.isValid(t)) {
      var o = t.getChildByName("pet").getComponent(sp.Skeleton),
          i = 0 == Math.floor(a.Utils.randomRang(0, 2)) ? "idle" : "idle2";
      o.setAnimation(0, i, !0), this.getTween(t).delay(this.idleTime).call(function () {
        e.isOwnedPet ? t.x > 0 ? e.petBackAnim(t) : e.petGoAnim(t) : n.TimeMgr.getInstance().isOpenTimer_pet ? t.x > 0 ? e.petBackAnim(t) : e.petGoAnim(t) : e.petGoOutAnim(t);
      }).start();
    }
  }, t.prototype.petGoAnim = function (t) {
    var e = this;

    if (cc.isValid(t)) {
      t.zIndex = 2, t.scaleX = -1;
      var o = Math.abs(t.x - this.rightPosX);
      t.getChildByName("pet").getComponent(sp.Skeleton).setAnimation(0, "move", !0), this.getTween(t).to(o / this.moveSpeedPet, {
        x: this.rightPosX
      }).call(function () {
        e.petIdleAnim(t);
      }).start();
    }
  }, t.prototype.petBackAnim = function (t) {
    var e = this;

    if (cc.isValid(t)) {
      t.zIndex = 0, t.scaleX = 1;
      var o = Math.abs(t.x - this.leftPosX);
      t.getChildByName("pet").getComponent(sp.Skeleton).setAnimation(0, "move", !0), this.getTween(t).to(o / this.moveSpeedPet, {
        x: this.leftPosX
      }).call(function () {
        e.petIdleAnim(t);
      }).start();
    }
  }, t;
}();

o["default"] = s;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcUGV0TWdyLmpzIl0sIm5hbWVzIjpbInQiLCJyZXF1aXJlIiwiZSIsIm1vZHVsZSIsIm8iLCJleHBvcnRzIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsImEiLCJpIiwiciIsIm4iLCJzIiwiaXNPd25lZFBldCIsInR3ZW5NYXAiLCJNYXAiLCJtb3ZlU3BlZWRQZXQiLCJlbnRlclBvc1giLCJsZWZ0UG9zWCIsInJpZ2h0UG9zWCIsImlkbGVUaW1lIiwiZ2V0SW5zdGFuY2UiLCJpbnN0YW5jZSIsInByb3RvdHlwZSIsImluaXRQZXREYXRhIiwiUGxheWVyTWdyIiwiZ2VVc2VyRGF0YSIsImlzRXhpc3RQZXRGb3RJZCIsImdldFR3ZWVuIiwiaGFzIiwidXVpZCIsInN0b3BUd2VlbiIsImNjIiwidHdlZW4iLCJzZXQiLCJnZXQiLCJzdG9wIiwicGV0RW50ZXJBbmltIiwiaXNWYWxpZCIsIk1hdGgiLCJhYnMiLCJ4IiwiZ2V0Q2hpbGRCeU5hbWUiLCJnZXRDb21wb25lbnQiLCJzcCIsIlNrZWxldG9uIiwic2V0QW5pbWF0aW9uIiwidG8iLCJjYWxsIiwiZ2V0VHJhY2tEYXRhIiwieW91bWVuZ1RyYWNrIiwiVHJhY2tJZCIsInBldF9hcHBlYXIiLCJwZXRJZGxlQW5pbSIsInN0YXJ0IiwicGV0R29PdXRBbmltIiwiekluZGV4Iiwic2NhbGVYIiwiZmxvb3IiLCJVdGlscyIsInJhbmRvbVJhbmciLCJkZWxheSIsInBldEJhY2tBbmltIiwicGV0R29BbmltIiwiVGltZU1nciIsImlzT3BlblRpbWVyX3BldCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFDLEdBQUdDLE9BQVI7QUFDQSxJQUFJQyxDQUFDLEdBQUdDLE1BQVI7QUFDQSxJQUFJQyxDQUFDLEdBQUdDLE9BQVI7QUFDQUMsTUFBTSxDQUFDQyxjQUFQLENBQXNCSCxDQUF0QixFQUF5QixZQUF6QixFQUF1QztFQUNuQ0ksS0FB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LFlBQXhCLENBQXFDQyxFQUFFLENBQUNDLFFBQXhDLEVBQWtEQyxZQUFsRCxDQUErRCxDQUEvRCxFQUFrRSxNQUFsRSxFQUEwRSxDQUFDLENBQTNFLEdBQ0EsS0FBS2xCLFFBQUwsQ0FBYzdCLENBQWQsRUFBaUJnRCxFQUFqQixDQUFvQjVDLENBQUMsR0FBRyxLQUFLYSxZQUE3QixFQUEyQztRQUN2Q3lCLENBQUMsRUFBRSxLQUFLdkI7TUFEK0IsQ0FBM0MsRUFFRzhCLElBRkgsQ0FFUSxZQUFXO1FBQ2YvQyxDQUFDLENBQUNvRCxXQUFGLENBQWN0RCxDQUFkO01BQ0gsQ0FKRCxFQUlHdUQsS0FKSCxFQURBO0lBTUg7RUFDSixDQWpGTSxFQWtGUHZELENBbEZBO0FBbUZILENBN0ZHLEVBSko7O0FBa0dBSSxDQUFDLFdBQUQsR0FBWVMsQ0FBWiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHQgPSByZXF1aXJlO1xudmFyIGUgPSBtb2R1bGU7XG52YXIgbyA9IGV4cG9ydHM7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgICB2YWx1ZTogITBcbn0pO1xudmFyIGEgPSB0KFwiVXRpbHNcIiksXG5pID0gdChcIlRyYWNrRGF0YUV2ZW50XCIpLFxuciA9IHQoXCJQbGF5ZXJNZ3JcIiksXG5uID0gdChcIlRpbWVNZ3JcIiksXG5zID0gZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gdCgpIHtcbiAgICAgICAgdGhpcy5pc093bmVkUGV0ID0gITEsXG4gICAgICAgIHRoaXMudHdlbk1hcCA9IG5ldyBNYXAsXG4gICAgICAgIHRoaXMubW92ZVNwZWVkUGV0ID0gMTUwLFxuICAgICAgICB0aGlzLmVudGVyUG9zWCA9IC0xZTMsXG4gICAgICAgIHRoaXMubGVmdFBvc1ggPSAtMjUwLFxuICAgICAgICB0aGlzLnJpZ2h0UG9zWCA9IDI1MCxcbiAgICAgICAgdGhpcy5pZGxlVGltZSA9IDNcbiAgICB9XG4gICAgcmV0dXJuIHQuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgPT0gdGhpcy5pbnN0YW5jZSAmJiAodGhpcy5pbnN0YW5jZSA9IG5ldyB0KSxcbiAgICAgICAgdGhpcy5pbnN0YW5jZVxuICAgIH0sXG4gICAgdC5wcm90b3R5cGUuaW5pdFBldERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgci5QbGF5ZXJNZ3IuZ2V0SW5zdGFuY2UoKS5nZVVzZXJEYXRhKCkuaXNFeGlzdFBldEZvdElkKDEpICYmICh0aGlzLmlzT3duZWRQZXQgPSAhMClcbiAgICB9LFxuICAgIHQucHJvdG90eXBlLmdldFR3ZWVuID0gZnVuY3Rpb24odCkge1xuICAgICAgICB0aGlzLnR3ZW5NYXAuaGFzKHQudXVpZCkgJiYgdGhpcy5zdG9wVHdlZW4odCk7XG4gICAgICAgIHZhciBlID0gY2MudHdlZW4odCk7XG4gICAgICAgIHJldHVybiB0aGlzLnR3ZW5NYXAuc2V0KHQudXVpZCwgZSksXG4gICAgICAgIGVcbiAgICB9LFxuICAgIHQucHJvdG90eXBlLnN0b3BUd2VlbiA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgdGhpcy50d2VuTWFwLmhhcyh0LnV1aWQpICYmICh0aGlzLnR3ZW5NYXAuZ2V0KHQudXVpZCkuc3RvcCgpLCB0aGlzLnR3ZW5NYXAuZGVsZXRlKHQudXVpZCkpXG4gICAgfSxcbiAgICB0LnByb3RvdHlwZS5wZXRFbnRlckFuaW0gPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgaWYgKGNjLmlzVmFsaWQodCkpIHtcbiAgICAgICAgICAgIHZhciBvID0gTWF0aC5hYnModC54IC0gdGhpcy5sZWZ0UG9zWCk7XG4gICAgICAgICAgICB0LmdldENoaWxkQnlOYW1lKFwicGV0XCIpLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbikuc2V0QW5pbWF0aW9uKDAsIFwibW92ZVwiLCAhMCksXG4gICAgICAgICAgICB0aGlzLmdldFR3ZWVuKHQpLnRvKG8gLyB0aGlzLm1vdmVTcGVlZFBldCwge1xuICAgICAgICAgICAgICAgIHg6IHRoaXMubGVmdFBvc1hcbiAgICAgICAgICAgIH0pLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgci5QbGF5ZXJNZ3IuZ2V0SW5zdGFuY2UoKS5nZXRUcmFja0RhdGEoKS55b3VtZW5nVHJhY2soaS5UcmFja0lkLnBldF9hcHBlYXIpLFxuICAgICAgICAgICAgICAgIGUucGV0SWRsZUFuaW0odClcbiAgICAgICAgICAgIH0pLnN0YXJ0KClcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdC5wcm90b3R5cGUucGV0R29PdXRBbmltID0gZnVuY3Rpb24odCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIGlmIChjYy5pc1ZhbGlkKHQpKSB7XG4gICAgICAgICAgICB0LnpJbmRleCA9IDAsXG4gICAgICAgICAgICB0LnNjYWxlWCA9IDE7XG4gICAgICAgICAgICB2YXIgbyA9IE1hdGguYWJzKHQueCAtIHRoaXMuZW50ZXJQb3NYKTtcbiAgICAgICAgICAgIHQuZ2V0Q2hpbGRCeU5hbWUoXCJwZXRcIikuZ2V0Q29tcG9uZW50KHNwLlNrZWxldG9uKS5zZXRBbmltYXRpb24oMCwgXCJtb3ZlXCIsICEwKSxcbiAgICAgICAgICAgIHRoaXMuZ2V0VHdlZW4odCkudG8obyAvIHRoaXMubW92ZVNwZWVkUGV0LCB7XG4gICAgICAgICAgICAgICAgeDogdGhpcy5lbnRlclBvc1hcbiAgICAgICAgICAgIH0pLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZS5wZXRJZGxlQW5pbSh0KVxuICAgICAgICAgICAgfSkuc3RhcnQoKVxuICAgICAgICB9XG4gICAgfSxcbiAgICB0LnByb3RvdHlwZS5wZXRJZGxlQW5pbSA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICBpZiAoY2MuaXNWYWxpZCh0KSkge1xuICAgICAgICAgICAgdmFyIG8gPSB0LmdldENoaWxkQnlOYW1lKFwicGV0XCIpLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbiksXG4gICAgICAgICAgICBpID0gMCA9PSBNYXRoLmZsb29yKGEuVXRpbHMucmFuZG9tUmFuZygwLCAyKSkgPyBcImlkbGVcIjogXCJpZGxlMlwiO1xuICAgICAgICAgICAgby5zZXRBbmltYXRpb24oMCwgaSwgITApLFxuICAgICAgICAgICAgdGhpcy5nZXRUd2Vlbih0KS5kZWxheSh0aGlzLmlkbGVUaW1lKS5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGUuaXNPd25lZFBldCA/IHQueCA+IDAgPyBlLnBldEJhY2tBbmltKHQpIDogZS5wZXRHb0FuaW0odCkgOiBuLlRpbWVNZ3IuZ2V0SW5zdGFuY2UoKS5pc09wZW5UaW1lcl9wZXQgPyB0LnggPiAwID8gZS5wZXRCYWNrQW5pbSh0KSA6IGUucGV0R29BbmltKHQpIDogZS5wZXRHb091dEFuaW0odClcbiAgICAgICAgICAgIH0pLnN0YXJ0KClcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdC5wcm90b3R5cGUucGV0R29BbmltID0gZnVuY3Rpb24odCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIGlmIChjYy5pc1ZhbGlkKHQpKSB7XG4gICAgICAgICAgICB0LnpJbmRleCA9IDIsXG4gICAgICAgICAgICB0LnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgdmFyIG8gPSBNYXRoLmFicyh0LnggLSB0aGlzLnJpZ2h0UG9zWCk7XG4gICAgICAgICAgICB0LmdldENoaWxkQnlOYW1lKFwicGV0XCIpLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbikuc2V0QW5pbWF0aW9uKDAsIFwibW92ZVwiLCAhMCksXG4gICAgICAgICAgICB0aGlzLmdldFR3ZWVuKHQpLnRvKG8gLyB0aGlzLm1vdmVTcGVlZFBldCwge1xuICAgICAgICAgICAgICAgIHg6IHRoaXMucmlnaHRQb3NYXG4gICAgICAgICAgICB9KS5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGUucGV0SWRsZUFuaW0odClcbiAgICAgICAgICAgIH0pLnN0YXJ0KClcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdC5wcm90b3R5cGUucGV0QmFja0FuaW0gPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgaWYgKGNjLmlzVmFsaWQodCkpIHtcbiAgICAgICAgICAgIHQuekluZGV4ID0gMCxcbiAgICAgICAgICAgIHQuc2NhbGVYID0gMTtcbiAgICAgICAgICAgIHZhciBvID0gTWF0aC5hYnModC54IC0gdGhpcy5sZWZ0UG9zWCk7XG4gICAgICAgICAgICB0LmdldENoaWxkQnlOYW1lKFwicGV0XCIpLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbikuc2V0QW5pbWF0aW9uKDAsIFwibW92ZVwiLCAhMCksXG4gICAgICAgICAgICB0aGlzLmdldFR3ZWVuKHQpLnRvKG8gLyB0aGlzLm1vdmVTcGVlZFBldCwge1xuICAgICAgICAgICAgICAgIHg6IHRoaXMubGVmdFBvc1hcbiAgICAgICAgICAgIH0pLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZS5wZXRJZGxlQW5pbSh0KVxuICAgICAgICAgICAgfSkuc3RhcnQoKVxuICAgICAgICB9XG4gICAgfSxcbiAgICB0XG59ICgpO1xuby5kZWZhdWx0ID0gcyJdfQ==