
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/ResCacheMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9b2e1znp0JK1pwthkWLQinF', 'ResCacheMgr');
// scripts/ResCacheMgr.js

"use strict";

var t = require;
var e = module;
var o = exports;

var _a,
    i = void 0 && (void 0).__extends || (_a = function a(t, e) {
  return (_a = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function (t, e) {
    t.__proto__ = e;
  } || function (t, e) {
    for (var o in e) {
      Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
    }
  })(t, e);
}, function (t, e) {
  function o() {
    this.constructor = t;
  }

  _a(t, e), t.prototype = null === e ? Object.create(e) : (o.prototype = e.prototype, new o());
});

Object.defineProperty(o, "__esModule", {
  value: !0
}), o.ResCacheMgr = void 0;

var r = t("BaseMgr"),
    n = t("TimeUtils"),
    s = t("UIUtils"),
    c = t("ResourceMgr"),
    l = function (t) {
  function e() {
    var e = t.call(this) || this;
    return e.temporaryCache = [], e.permanentCache = [], e.isStartDecRef = !1, e.assetsLifeTime = 5, e.permanentCacheKeyMap = new Map(), e.depsdeps = [], e;
  }

  return i(e, t), e.getInstance = function () {
    return null == this.instance && (this.instance = new e()), this.instance;
  }, e.prototype.init = function () {
    this.startDecRef();
  }, e.prototype.startDecRef = function () {
    this.isStartDecRef || (this.isStartDecRef = !0, s.UIUtils.schedule(this.autoRelease, this, 1));
  }, e.prototype.autoRelease = function () {
    for (var t = n.TimeUtils.GetTimeBySecond(), e = 0; e < this.temporaryCache.length; e++) {
      var o = this.temporaryCache[e];

      if (o && t - o.releaseTime >= o.cacheTime) {
        if (o.defCount <= 0) continue;

        for (var a = o.defCount, i = 0; i < a; i++) {
          if (o.asset.decRef(), o.asset.refCount <= 0) {
            this.temporaryCache.splice(e, 1), e--, o.defCount = 0;
            break;
          }
        }

        o.asset.refCount > 0 && (o.releaseTime = n.TimeUtils.GetTimeBySecond() + 86400);
      } else o && 0 == o.asset.refCount && (this.temporaryCache.splice(e, 1), e--, o.defCount = 0);
    }
  }, e.prototype.refreshTime = function (t) {
    for (var e = n.TimeUtils.GetTimeBySecond(), o = 0; o < t.length; o++) {
      for (var a = 0; a < this.temporaryCache.length; a++) {
        var i = t[o],
            r = this.temporaryCache[a];

        if (i.cachekey == r.cachekey && i.type == r.type) {
          this.temporaryCache[a].releaseTime = e, this.temporaryCache[a].defCount += i.defCount, this.temporaryCache[a].canRelease = !1;
          break;
        }
      }
    }
  }, e.prototype.addAssets = function (t, e) {
    if (t && t.asset) {
      var o = e ? this.temporaryCache : this.permanentCache,
          a = this.isExistKey(t.cachekey, t.type, o);
      -1 == a ? o.push(t) : o[a] = t;
    }
  }, e.prototype.addAssetKeyToMap = function (t, e, o, a) {
    var i = this.permanentCacheKeyMap.get(t),
        r = new c.ResCacheKey(e, o, a);
    if (i && i.length > 0) i.push(r);else {
      var n = [];
      n.push(r), this.permanentCacheKeyMap.set(t, n);
    }
  }, e.prototype.releaseAssetsFromMap = function (t) {
    var e = this.permanentCacheKeyMap.get(t);
    if (e && e.length > 0) for (var o = 0; o < e.length; o++) {
      for (var a = 0; a < this.permanentCache.length; a++) {
        var i = this.permanentCache[a];

        if (i && i.cachekey == e[o].cachekey && i.type == e[o].type) {
          i.asset.decRef(), i.asset.refCount <= 0 && (this.permanentCache.splice(a, 1), a--);
          break;
        }
      }
    }
  }, e.prototype.getAssets = function (t, e, o) {
    var a = "";
    o && (a = cc.js.getClassName(o));
    var i,
        r = n.TimeUtils.GetTimeBySecond(),
        s = r + 86400,
        c = t + "/" + e,
        l = this.isExistKey(c, a, this.temporaryCache),
        u = this.isExistKey(c, a, this.permanentCache),
        p = null,
        g = null;
    return -1 != l && (this.temporaryCache[l].releaseTime = s, this.temporaryCache[l].createTime = r, this.temporaryCache[l].canRelease = !0, (i = this.temporaryCache[l].asset) && i.refCount > 0 && (p = this.temporaryCache[l])), -1 != u && (this.permanentCache[u].releaseTime = s, this.permanentCache[u].createTime = r, this.permanentCache[u].canRelease = !0, (i = this.permanentCache[u].asset) && i.refCount > 0 && (g = this.permanentCache[u])), p || g || null;
  }, e.prototype.isExistKey = function (t, e, o) {
    for (var a = 0; a < o.length; a++) {
      var i = o[a];
      if (i && i.cachekey == t && i.type == e) return a;
    }

    return -1;
  }, e.prototype.visitAsset = function (t, e) {
    if (t._uuid) e.push(t._uuid);else if (t instanceof cc.SpriteFrame) {
      var o,
          a = t;
      a._original ? (o = a._original._texture) && e.push(o._uuid) : (o = a.getTexture()) && e.push(o._uuid);
    }
  }, e.prototype.visitComponent = function (t, e) {
    for (var o = Object.getOwnPropertyNames(t), a = 0; a < o.length; a++) {
      var i = o[a];

      if ("node" !== i && "__eventTargets" !== i) {
        var r = t[i];
        if (r instanceof cc.NodePool) this.visitNodePool(r, e);else if ("object" == typeof r && r) if (Array.isArray(r)) for (var n = 0; n < r.length; n++) {
          (c = r[n]) instanceof cc.Asset && this.visitAsset(c, e);
        } else if (r.constructor && r.constructor !== Object) r instanceof cc.Asset && this.visitAsset(r, e);else {
          var s = Object.getOwnPropertyNames(r);

          for (n = 0; n < s.length; n++) {
            var c;
            (c = r[s[n]]) instanceof cc.Asset && this.visitAsset(c, e);
          }
        }
      }
    }
  }, e.prototype.visitNode = function (t, e) {
    for (var o = 0; o < t._components.length; o++) {
      this.visitComponent(t._components[o], e);
    }

    for (o = 0; o < t._children.length; o++) {
      this.visitNode(t._children[o], e);
    }
  }, e.prototype.visitNodePool = function (t, e) {
    for (var o = t._pool, a = 0; a < o.length; a++) {
      var i = o[a];
      this.visitNode(i, e);
    }
  }, e.instance = null, e;
}(r["default"]);

o.ResCacheMgr = l;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcUmVzQ2FjaGVNZ3IuanMiXSwibmFtZXMiOlsidCIsInJlcXVpcmUiLCJlIiwibW9kdWxlIiwibyIsImV4cG9ydHMiLCJhIiwiaSIsIl9fZXh0ZW5kcyIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsImRlZmluZVByb3BlcnR5IiwidmFsdWUiLCJSZXNDYWNoZU1nciIsInIiLCJuIiwicyIsImMiLCJsIiwidGVtcG9yYXJ5Q2FjaGUiLCJwZXJtYW5lbnRDYWNoZSIsImlzU3RhcnREZWNSZWYiLCJhc3NldHNMaWZlVGltZSIsInBlcm1hbmVudENhY2hlS2V5TWFwIiwiTWFwIiwiZGVwc2RlcHMiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiaW5pdCIsInN0YXJ0RGVjUmVmIiwiVUlVdGlscyIsInNjaGVkdWxlIiwiYXV0b1JlbGVhc2UiLCJUaW1lVXRpbHMiLCJHZXRUaW1lQnlTZWNvbmQiLCJsZW5ndGgiLCJyZWxlYXNlVGltZSIsImNhY2hlVGltZSIsImRlZkNvdW50IiwiYXNzZXQiLCJkZWNSZWYiLCJyZWZDb3VudCIsInNwbGljZSIsInJlZnJlc2hUaW1lIiwiY2FjaGVrZXkiLCJ0eXBlIiwiY2FuUmVsZWFzZSIsImFkZEFzc2V0cyIsImlzRXhpc3RLZXkiLCJwdXNoIiwiYWRkQXNzZXRLZXlUb01hcCIsImdldCIsIlJlc0NhY2hlS2V5Iiwic2V0IiwicmVsZWFzZUFzc2V0c0Zyb21NYXAiLCJnZXRBc3NldHMiLCJjYyIsImpzIiwiZ2V0Q2xhc3NOYW1lIiwidSIsInAiLCJnIiwiY3JlYXRlVGltZSIsInZpc2l0QXNzZXQiLCJfdXVpZCIsIlNwcml0ZUZyYW1lIiwiX29yaWdpbmFsIiwiX3RleHR1cmUiLCJnZXRUZXh0dXJlIiwidmlzaXRDb21wb25lbnQiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiTm9kZVBvb2wiLCJ2aXNpdE5vZGVQb29sIiwiaXNBcnJheSIsIkFzc2V0IiwidmlzaXROb2RlIiwiX2NvbXBvbmVudHMiLCJfY2hpbGRyZW4iLCJfcG9vbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFDLEdBQUdDLE9BQVI7QUFDQSxJQUFJQyxDQUFDLEdBQUdDLE1BQVI7QUFDQSxJQUFJQyxDQUFDLEdBQUdDLE9BQVI7O0FBQ0EsSUFBSUMsRUFBSjtBQUFBLElBQU9DLENBQUMsR0FBRyxVQUFRLFNBQUtDLFNBQWIsS0FBMkJGLEVBQUMsR0FBRyxXQUFTTixDQUFULEVBQVlFLENBQVosRUFBZTtFQUNyRCxPQUFPLENBQUNJLEVBQUMsR0FBR0csTUFBTSxDQUFDQyxjQUFQLElBQXlCO0lBQ2pDQyxTQUFTLEVBQUU7RUFEc0IsYUFHMUJDLEtBSDBCLElBSXJDLFVBQVNaLENBQVQsRUFBWUUsQ0FBWixFQUFlO0lBQ1hGLENBQUMsQ0FBQ1csU0FBRixHQUFjVCxDQUFkO0VBQ0gsQ0FOVyxJQU9aLFVBQVNGLENBQVQsRUFBWUUsQ0FBWixFQUFlO0lBQ1gsS0FBSyxJQUFJRSxDQUFULElBQWNGLENBQWQ7TUFBaUJPLE1BQU0sQ0FBQ0ksU0FBUCxDQUFpQkMsY0FBakIsQ0FBZ0NDLElBQWhDLENBQXFDYixDQUFyQyxFQUF3Q0UsQ0FBeEMsTUFBK0NKLENBQUMsQ0FBQ0ksQ0FBRCxDQUFELEdBQU9GLENBQUMsQ0FBQ0UsQ0FBRCxDQUF2RDtJQUFqQjtFQUNILENBVE0sRUFTSkosQ0FUSSxFQVNERSxDQVRDLENBQVA7QUFVSCxDQVhxQyxFQVl0QyxVQUFTRixDQUFULEVBQVlFLENBQVosRUFBZTtFQUNYLFNBQVNFLENBQVQsR0FBYTtJQUNULEtBQUtZLFdBQUwsR0FBbUJoQixDQUFuQjtFQUNIOztFQUNETSxFQUFDLENBQUNOLENBQUQsRUFBSUUsQ0FBSixDQUFELEVBQ0FGLENBQUMsQ0FBQ2EsU0FBRixHQUFjLFNBQVNYLENBQVQsR0FBYU8sTUFBTSxDQUFDUSxNQUFQLENBQWNmLENBQWQsQ0FBYixJQUFpQ0UsQ0FBQyxDQUFDUyxTQUFGLEdBQWNYLENBQUMsQ0FBQ1csU0FBaEIsRUFBMkIsSUFBSVQsQ0FBSixFQUE1RCxDQURkO0FBRUgsQ0FsQlUsQ0FBWDs7QUFtQkFLLE1BQU0sQ0FBQ1MsY0FBUCxDQUFzQmQsQ0FBdEIsRUFBeUIsWUFBekIsRUFBdUM7RUFDbkNlLEtBQUssRUFBRSxDQUFDO0FBRDJCLENBQXZDLEdBR0FmLENBQUMsQ0FBQ2dCLFdBQUYsR0FBZ0IsS0FBSyxDQUhyQjs7QUFJQSxJQUFJQyxDQUFDLEdBQUdyQixDQUFDLENBQUMsU0FBRCxDQUFUO0FBQUEsSUFDQXNCLENBQUMsR0FBR3RCLENBQUMsQ0FBQyxXQUFELENBREw7QUFBQSxJQUVBdUIsQ0FBQyxHQUFHdkIsQ0FBQyxDQUFDLFNBQUQsQ0FGTDtBQUFBLElBR0F3QixDQUFDLEdBQUd4QixDQUFDLENBQUMsYUFBRCxDQUhMO0FBQUEsSUFJQXlCLENBQUMsR0FBRyxVQUFTekIsQ0FBVCxFQUFZO0VBQ1osU0FBU0UsQ0FBVCxHQUFhO0lBQ1QsSUFBSUEsQ0FBQyxHQUFHRixDQUFDLENBQUNlLElBQUYsQ0FBTyxJQUFQLEtBQWdCLElBQXhCO0lBQ0EsT0FBT2IsQ0FBQyxDQUFDd0IsY0FBRixHQUFtQixFQUFuQixFQUNQeEIsQ0FBQyxDQUFDeUIsY0FBRixHQUFtQixFQURaLEVBRVB6QixDQUFDLENBQUMwQixhQUFGLEdBQWtCLENBQUMsQ0FGWixFQUdQMUIsQ0FBQyxDQUFDMkIsY0FBRixHQUFtQixDQUhaLEVBSVAzQixDQUFDLENBQUM0QixvQkFBRixHQUF5QixJQUFJQyxHQUFKLEVBSmxCLEVBS1A3QixDQUFDLENBQUM4QixRQUFGLEdBQWEsRUFMTixFQU1QOUIsQ0FOQTtFQU9IOztFQUNELE9BQU9LLENBQUMsQ0FBQ0wsQ0FBRCxFQUFJRixDQUFKLENBQUQsRUFDUEUsQ0FBQyxDQUFDK0IsV0FBRixHQUFnQixZQUFXO0lBQ3ZCLE9BQU8sUUFBUSxLQUFLQyxRQUFiLEtBQTBCLEtBQUtBLFFBQUwsR0FBZ0IsSUFBSWhDLENBQUosRUFBMUMsR0FDUCxLQUFLZ0MsUUFETDtFQUVILENBSk0sRUFLUGhDLENBQUMsQ0FBQ1csU0FBRixDQUFZc0IsSUFBWixHQUFtQixZQUFXO0lBQzFCLEtBQUtDLFdBQUw7RUFDSCxDQVBNLEVBUVBsQyxDQUFDLENBQUNXLFNBQUYsQ0FBWXVCLFdBQVosR0FBMEIsWUFBVztJQUNqQyxLQUFLUixhQUFMLEtBQXVCLEtBQUtBLGFBQUwsR0FBcUIsQ0FBQyxDQUF0QixFQUF5QkwsQ0FBQyxDQUFDYyxPQUFGLENBQVVDLFFBQVYsQ0FBbUIsS0FBS0MsV0FBeEIsRUFBcUMsSUFBckMsRUFBMkMsQ0FBM0MsQ0FBaEQ7RUFDSCxDQVZNLEVBV1ByQyxDQUFDLENBQUNXLFNBQUYsQ0FBWTBCLFdBQVosR0FBMEIsWUFBVztJQUNqQyxLQUFLLElBQUl2QyxDQUFDLEdBQUdzQixDQUFDLENBQUNrQixTQUFGLENBQVlDLGVBQVosRUFBUixFQUF1Q3ZDLENBQUMsR0FBRyxDQUFoRCxFQUFtREEsQ0FBQyxHQUFHLEtBQUt3QixjQUFMLENBQW9CZ0IsTUFBM0UsRUFBbUZ4QyxDQUFDLEVBQXBGLEVBQXdGO01BQ3BGLElBQUlFLENBQUMsR0FBRyxLQUFLc0IsY0FBTCxDQUFvQnhCLENBQXBCLENBQVI7O01BQ0EsSUFBSUUsQ0FBQyxJQUFJSixDQUFDLEdBQUdJLENBQUMsQ0FBQ3VDLFdBQU4sSUFBcUJ2QyxDQUFDLENBQUN3QyxTQUFoQyxFQUEyQztRQUN2QyxJQUFJeEMsQ0FBQyxDQUFDeUMsUUFBRixJQUFjLENBQWxCLEVBQXFCOztRQUNyQixLQUFLLElBQUl2QyxDQUFDLEdBQUdGLENBQUMsQ0FBQ3lDLFFBQVYsRUFDTHRDLENBQUMsR0FBRyxDQURKLEVBQ09BLENBQUMsR0FBR0QsQ0FEWCxFQUNjQyxDQUFDLEVBRGY7VUFDbUIsSUFBSUgsQ0FBQyxDQUFDMEMsS0FBRixDQUFRQyxNQUFSLElBQWtCM0MsQ0FBQyxDQUFDMEMsS0FBRixDQUFRRSxRQUFSLElBQW9CLENBQTFDLEVBQTZDO1lBQzVELEtBQUt0QixjQUFMLENBQW9CdUIsTUFBcEIsQ0FBMkIvQyxDQUEzQixFQUE4QixDQUE5QixHQUNBQSxDQUFDLEVBREQsRUFFQUUsQ0FBQyxDQUFDeUMsUUFBRixHQUFhLENBRmI7WUFHQTtVQUNIO1FBTkQ7O1FBT0F6QyxDQUFDLENBQUMwQyxLQUFGLENBQVFFLFFBQVIsR0FBbUIsQ0FBbkIsS0FBeUI1QyxDQUFDLENBQUN1QyxXQUFGLEdBQWdCckIsQ0FBQyxDQUFDa0IsU0FBRixDQUFZQyxlQUFaLEtBQWdDLEtBQXpFO01BQ0gsQ0FWRCxNQVVPckMsQ0FBQyxJQUFJLEtBQUtBLENBQUMsQ0FBQzBDLEtBQUYsQ0FBUUUsUUFBbEIsS0FBK0IsS0FBS3RCLGNBQUwsQ0FBb0J1QixNQUFwQixDQUEyQi9DLENBQTNCLEVBQThCLENBQTlCLEdBQWtDQSxDQUFDLEVBQW5DLEVBQXVDRSxDQUFDLENBQUN5QyxRQUFGLEdBQWEsQ0FBbkY7SUFDVjtFQUNKLENBMUJNLEVBMkJQM0MsQ0FBQyxDQUFDVyxTQUFGLENBQVlxQyxXQUFaLEdBQTBCLFVBQVNsRCxDQUFULEVBQVk7SUFDbEMsS0FBSyxJQUFJRSxDQUFDLEdBQUdvQixDQUFDLENBQUNrQixTQUFGLENBQVlDLGVBQVosRUFBUixFQUF1Q3JDLENBQUMsR0FBRyxDQUFoRCxFQUFtREEsQ0FBQyxHQUFHSixDQUFDLENBQUMwQyxNQUF6RCxFQUFpRXRDLENBQUMsRUFBbEU7TUFBc0UsS0FBSyxJQUFJRSxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHLEtBQUtvQixjQUFMLENBQW9CZ0IsTUFBeEMsRUFBZ0RwQyxDQUFDLEVBQWpELEVBQXFEO1FBQ3ZILElBQUlDLENBQUMsR0FBR1AsQ0FBQyxDQUFDSSxDQUFELENBQVQ7UUFBQSxJQUNBaUIsQ0FBQyxHQUFHLEtBQUtLLGNBQUwsQ0FBb0JwQixDQUFwQixDQURKOztRQUVBLElBQUlDLENBQUMsQ0FBQzRDLFFBQUYsSUFBYzlCLENBQUMsQ0FBQzhCLFFBQWhCLElBQTRCNUMsQ0FBQyxDQUFDNkMsSUFBRixJQUFVL0IsQ0FBQyxDQUFDK0IsSUFBNUMsRUFBa0Q7VUFDOUMsS0FBSzFCLGNBQUwsQ0FBb0JwQixDQUFwQixFQUF1QnFDLFdBQXZCLEdBQXFDekMsQ0FBckMsRUFDQSxLQUFLd0IsY0FBTCxDQUFvQnBCLENBQXBCLEVBQXVCdUMsUUFBdkIsSUFBbUN0QyxDQUFDLENBQUNzQyxRQURyQyxFQUVBLEtBQUtuQixjQUFMLENBQW9CcEIsQ0FBcEIsRUFBdUIrQyxVQUF2QixHQUFvQyxDQUFDLENBRnJDO1VBR0E7UUFDSDtNQUNKO0lBVEQ7RUFVSCxDQXRDTSxFQXVDUG5ELENBQUMsQ0FBQ1csU0FBRixDQUFZeUMsU0FBWixHQUF3QixVQUFTdEQsQ0FBVCxFQUFZRSxDQUFaLEVBQWU7SUFDbkMsSUFBSUYsQ0FBQyxJQUFJQSxDQUFDLENBQUM4QyxLQUFYLEVBQWtCO01BQ2QsSUFBSTFDLENBQUMsR0FBR0YsQ0FBQyxHQUFHLEtBQUt3QixjQUFSLEdBQXdCLEtBQUtDLGNBQXRDO01BQUEsSUFDQXJCLENBQUMsR0FBRyxLQUFLaUQsVUFBTCxDQUFnQnZELENBQUMsQ0FBQ21ELFFBQWxCLEVBQTRCbkQsQ0FBQyxDQUFDb0QsSUFBOUIsRUFBb0NoRCxDQUFwQyxDQURKO01BQzRDLENBQUUsQ0FBRixJQUFPRSxDQUFQLEdBQVdGLENBQUMsQ0FBQ29ELElBQUYsQ0FBT3hELENBQVAsQ0FBWCxHQUF1QkksQ0FBQyxDQUFDRSxDQUFELENBQUQsR0FBT04sQ0FBOUI7SUFDL0M7RUFDSixDQTVDTSxFQTZDUEUsQ0FBQyxDQUFDVyxTQUFGLENBQVk0QyxnQkFBWixHQUErQixVQUFTekQsQ0FBVCxFQUFZRSxDQUFaLEVBQWVFLENBQWYsRUFBa0JFLENBQWxCLEVBQXFCO0lBQ2hELElBQUlDLENBQUMsR0FBRyxLQUFLdUIsb0JBQUwsQ0FBMEI0QixHQUExQixDQUE4QjFELENBQTlCLENBQVI7SUFBQSxJQUNBcUIsQ0FBQyxHQUFHLElBQUlHLENBQUMsQ0FBQ21DLFdBQU4sQ0FBa0J6RCxDQUFsQixFQUFxQkUsQ0FBckIsRUFBd0JFLENBQXhCLENBREo7SUFFQSxJQUFJQyxDQUFDLElBQUlBLENBQUMsQ0FBQ21DLE1BQUYsR0FBVyxDQUFwQixFQUF1Qm5DLENBQUMsQ0FBQ2lELElBQUYsQ0FBT25DLENBQVAsRUFBdkIsS0FDSztNQUNELElBQUlDLENBQUMsR0FBRyxFQUFSO01BQ0FBLENBQUMsQ0FBQ2tDLElBQUYsQ0FBT25DLENBQVAsR0FDQSxLQUFLUyxvQkFBTCxDQUEwQjhCLEdBQTFCLENBQThCNUQsQ0FBOUIsRUFBaUNzQixDQUFqQyxDQURBO0lBRUg7RUFDSixDQXRETSxFQXVEUHBCLENBQUMsQ0FBQ1csU0FBRixDQUFZZ0Qsb0JBQVosR0FBbUMsVUFBUzdELENBQVQsRUFBWTtJQUMzQyxJQUFJRSxDQUFDLEdBQUcsS0FBSzRCLG9CQUFMLENBQTBCNEIsR0FBMUIsQ0FBOEIxRCxDQUE5QixDQUFSO0lBQ0EsSUFBSUUsQ0FBQyxJQUFJQSxDQUFDLENBQUN3QyxNQUFGLEdBQVcsQ0FBcEIsRUFBdUIsS0FBSyxJQUFJdEMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0YsQ0FBQyxDQUFDd0MsTUFBdEIsRUFBOEJ0QyxDQUFDLEVBQS9CO01BQW1DLEtBQUssSUFBSUUsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRyxLQUFLcUIsY0FBTCxDQUFvQmUsTUFBeEMsRUFBZ0RwQyxDQUFDLEVBQWpELEVBQXFEO1FBQzNHLElBQUlDLENBQUMsR0FBRyxLQUFLb0IsY0FBTCxDQUFvQnJCLENBQXBCLENBQVI7O1FBQ0EsSUFBSUMsQ0FBQyxJQUFJQSxDQUFDLENBQUM0QyxRQUFGLElBQWNqRCxDQUFDLENBQUNFLENBQUQsQ0FBRCxDQUFLK0MsUUFBeEIsSUFBb0M1QyxDQUFDLENBQUM2QyxJQUFGLElBQVVsRCxDQUFDLENBQUNFLENBQUQsQ0FBRCxDQUFLZ0QsSUFBdkQsRUFBNkQ7VUFDekQ3QyxDQUFDLENBQUN1QyxLQUFGLENBQVFDLE1BQVIsSUFDQXhDLENBQUMsQ0FBQ3VDLEtBQUYsQ0FBUUUsUUFBUixJQUFvQixDQUFwQixLQUEwQixLQUFLckIsY0FBTCxDQUFvQnNCLE1BQXBCLENBQTJCM0MsQ0FBM0IsRUFBOEIsQ0FBOUIsR0FBa0NBLENBQUMsRUFBN0QsQ0FEQTtVQUVBO1FBQ0g7TUFDSjtJQVBzQjtFQVExQixDQWpFTSxFQWtFUEosQ0FBQyxDQUFDVyxTQUFGLENBQVlpRCxTQUFaLEdBQXdCLFVBQVM5RCxDQUFULEVBQVlFLENBQVosRUFBZUUsQ0FBZixFQUFrQjtJQUN0QyxJQUFJRSxDQUFDLEdBQUcsRUFBUjtJQUNBRixDQUFDLEtBQUtFLENBQUMsR0FBR3lELEVBQUUsQ0FBQ0MsRUFBSCxDQUFNQyxZQUFOLENBQW1CN0QsQ0FBbkIsQ0FBVCxDQUFEO0lBQ0EsSUFBSUcsQ0FBSjtJQUFBLElBQU9jLENBQUMsR0FBR0MsQ0FBQyxDQUFDa0IsU0FBRixDQUFZQyxlQUFaLEVBQVg7SUFBQSxJQUNBbEIsQ0FBQyxHQUFHRixDQUFDLEdBQUcsS0FEUjtJQUFBLElBRUFHLENBQUMsR0FBR3hCLENBQUMsR0FBRyxHQUFKLEdBQVVFLENBRmQ7SUFBQSxJQUdBdUIsQ0FBQyxHQUFHLEtBQUs4QixVQUFMLENBQWdCL0IsQ0FBaEIsRUFBbUJsQixDQUFuQixFQUFzQixLQUFLb0IsY0FBM0IsQ0FISjtJQUFBLElBSUF3QyxDQUFDLEdBQUcsS0FBS1gsVUFBTCxDQUFnQi9CLENBQWhCLEVBQW1CbEIsQ0FBbkIsRUFBc0IsS0FBS3FCLGNBQTNCLENBSko7SUFBQSxJQUtBd0MsQ0FBQyxHQUFHLElBTEo7SUFBQSxJQU1BQyxDQUFDLEdBQUcsSUFOSjtJQU9BLE9BQU8sQ0FBRSxDQUFGLElBQU8zQyxDQUFQLEtBQWEsS0FBS0MsY0FBTCxDQUFvQkQsQ0FBcEIsRUFBdUJrQixXQUF2QixHQUFxQ3BCLENBQXJDLEVBQXdDLEtBQUtHLGNBQUwsQ0FBb0JELENBQXBCLEVBQXVCNEMsVUFBdkIsR0FBb0NoRCxDQUE1RSxFQUErRSxLQUFLSyxjQUFMLENBQW9CRCxDQUFwQixFQUF1QjRCLFVBQXZCLEdBQW9DLENBQUMsQ0FBcEgsRUFBdUgsQ0FBQzlDLENBQUMsR0FBRyxLQUFLbUIsY0FBTCxDQUFvQkQsQ0FBcEIsRUFBdUJxQixLQUE1QixLQUFzQ3ZDLENBQUMsQ0FBQ3lDLFFBQUYsR0FBYSxDQUFuRCxLQUF5RG1CLENBQUMsR0FBRyxLQUFLekMsY0FBTCxDQUFvQkQsQ0FBcEIsQ0FBN0QsQ0FBcEksR0FDUCxDQUFDLENBQUQsSUFBTXlDLENBQU4sS0FBWSxLQUFLdkMsY0FBTCxDQUFvQnVDLENBQXBCLEVBQXVCdkIsV0FBdkIsR0FBcUNwQixDQUFyQyxFQUF3QyxLQUFLSSxjQUFMLENBQW9CdUMsQ0FBcEIsRUFBdUJHLFVBQXZCLEdBQW9DaEQsQ0FBNUUsRUFBK0UsS0FBS00sY0FBTCxDQUFvQnVDLENBQXBCLEVBQXVCYixVQUF2QixHQUFvQyxDQUFDLENBQXBILEVBQXVILENBQUM5QyxDQUFDLEdBQUcsS0FBS29CLGNBQUwsQ0FBb0J1QyxDQUFwQixFQUF1QnBCLEtBQTVCLEtBQXNDdkMsQ0FBQyxDQUFDeUMsUUFBRixHQUFhLENBQW5ELEtBQXlEb0IsQ0FBQyxHQUFHLEtBQUt6QyxjQUFMLENBQW9CdUMsQ0FBcEIsQ0FBN0QsQ0FBbkksQ0FETyxFQUVQQyxDQUFDLElBQUlDLENBQUwsSUFBVSxJQUZWO0VBR0gsQ0EvRU0sRUFnRlBsRSxDQUFDLENBQUNXLFNBQUYsQ0FBWTBDLFVBQVosR0FBeUIsVUFBU3ZELENBQVQsRUFBWUUsQ0FBWixFQUFlRSxDQUFmLEVBQWtCO0lBQ3ZDLEtBQUssSUFBSUUsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0YsQ0FBQyxDQUFDc0MsTUFBdEIsRUFBOEJwQyxDQUFDLEVBQS9CLEVBQW1DO01BQy9CLElBQUlDLENBQUMsR0FBR0gsQ0FBQyxDQUFDRSxDQUFELENBQVQ7TUFDQSxJQUFJQyxDQUFDLElBQUlBLENBQUMsQ0FBQzRDLFFBQUYsSUFBY25ELENBQW5CLElBQXdCTyxDQUFDLENBQUM2QyxJQUFGLElBQVVsRCxDQUF0QyxFQUF5QyxPQUFPSSxDQUFQO0lBQzVDOztJQUNELE9BQU8sQ0FBRSxDQUFUO0VBQ0gsQ0F0Rk0sRUF1RlBKLENBQUMsQ0FBQ1csU0FBRixDQUFZeUQsVUFBWixHQUF5QixVQUFTdEUsQ0FBVCxFQUFZRSxDQUFaLEVBQWU7SUFDcEMsSUFBSUYsQ0FBQyxDQUFDdUUsS0FBTixFQUFhckUsQ0FBQyxDQUFDc0QsSUFBRixDQUFPeEQsQ0FBQyxDQUFDdUUsS0FBVCxFQUFiLEtBQ0ssSUFBSXZFLENBQUMsWUFBWStELEVBQUUsQ0FBQ1MsV0FBcEIsRUFBaUM7TUFDbEMsSUFBSXBFLENBQUo7TUFBQSxJQUFPRSxDQUFDLEdBQUdOLENBQVg7TUFDQU0sQ0FBQyxDQUFDbUUsU0FBRixHQUFjLENBQUNyRSxDQUFDLEdBQUdFLENBQUMsQ0FBQ21FLFNBQUYsQ0FBWUMsUUFBakIsS0FBOEJ4RSxDQUFDLENBQUNzRCxJQUFGLENBQU9wRCxDQUFDLENBQUNtRSxLQUFULENBQTVDLEdBQThELENBQUNuRSxDQUFDLEdBQUdFLENBQUMsQ0FBQ3FFLFVBQUYsRUFBTCxLQUF3QnpFLENBQUMsQ0FBQ3NELElBQUYsQ0FBT3BELENBQUMsQ0FBQ21FLEtBQVQsQ0FBdEY7SUFDSDtFQUNKLENBN0ZNLEVBOEZQckUsQ0FBQyxDQUFDVyxTQUFGLENBQVkrRCxjQUFaLEdBQTZCLFVBQVM1RSxDQUFULEVBQVlFLENBQVosRUFBZTtJQUN4QyxLQUFLLElBQUlFLENBQUMsR0FBR0ssTUFBTSxDQUFDb0UsbUJBQVAsQ0FBMkI3RSxDQUEzQixDQUFSLEVBQXVDTSxDQUFDLEdBQUcsQ0FBaEQsRUFBbURBLENBQUMsR0FBR0YsQ0FBQyxDQUFDc0MsTUFBekQsRUFBaUVwQyxDQUFDLEVBQWxFLEVBQXNFO01BQ2xFLElBQUlDLENBQUMsR0FBR0gsQ0FBQyxDQUFDRSxDQUFELENBQVQ7O01BQ0EsSUFBSSxXQUFXQyxDQUFYLElBQWdCLHFCQUFxQkEsQ0FBekMsRUFBNEM7UUFDeEMsSUFBSWMsQ0FBQyxHQUFHckIsQ0FBQyxDQUFDTyxDQUFELENBQVQ7UUFDQSxJQUFJYyxDQUFDLFlBQVkwQyxFQUFFLENBQUNlLFFBQXBCLEVBQThCLEtBQUtDLGFBQUwsQ0FBbUIxRCxDQUFuQixFQUFzQm5CLENBQXRCLEVBQTlCLEtBQ0ssSUFBSSxZQUFZLE9BQU9tQixDQUFuQixJQUF3QkEsQ0FBNUIsRUFBK0IsSUFBSVQsS0FBSyxDQUFDb0UsT0FBTixDQUFjM0QsQ0FBZCxDQUFKLEVBQXNCLEtBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0QsQ0FBQyxDQUFDcUIsTUFBdEIsRUFBOEJwQixDQUFDLEVBQS9CO1VBQWtDLENBQUNFLENBQUMsR0FBR0gsQ0FBQyxDQUFDQyxDQUFELENBQU4sYUFBc0J5QyxFQUFFLENBQUNrQixLQUF6QixJQUFrQyxLQUFLWCxVQUFMLENBQWdCOUMsQ0FBaEIsRUFBbUJ0QixDQUFuQixDQUFsQztRQUFsQyxDQUF0QixNQUMvQixJQUFJbUIsQ0FBQyxDQUFDTCxXQUFGLElBQWlCSyxDQUFDLENBQUNMLFdBQUYsS0FBa0JQLE1BQXZDLEVBQStDWSxDQUFDLFlBQVkwQyxFQUFFLENBQUNrQixLQUFoQixJQUF5QixLQUFLWCxVQUFMLENBQWdCakQsQ0FBaEIsRUFBbUJuQixDQUFuQixDQUF6QixDQUEvQyxLQUNBO1VBQ0QsSUFBSXFCLENBQUMsR0FBR2QsTUFBTSxDQUFDb0UsbUJBQVAsQ0FBMkJ4RCxDQUEzQixDQUFSOztVQUNBLEtBQUtDLENBQUMsR0FBRyxDQUFULEVBQVlBLENBQUMsR0FBR0MsQ0FBQyxDQUFDbUIsTUFBbEIsRUFBMEJwQixDQUFDLEVBQTNCLEVBQStCO1lBQzNCLElBQUlFLENBQUo7WUFBTyxDQUFDQSxDQUFDLEdBQUdILENBQUMsQ0FBQ0UsQ0FBQyxDQUFDRCxDQUFELENBQUYsQ0FBTixhQUF5QnlDLEVBQUUsQ0FBQ2tCLEtBQTVCLElBQXFDLEtBQUtYLFVBQUwsQ0FBZ0I5QyxDQUFoQixFQUFtQnRCLENBQW5CLENBQXJDO1VBQ1Y7UUFDSjtNQUNKO0lBQ0o7RUFDSixDQTlHTSxFQStHUEEsQ0FBQyxDQUFDVyxTQUFGLENBQVlxRSxTQUFaLEdBQXdCLFVBQVNsRixDQUFULEVBQVlFLENBQVosRUFBZTtJQUNuQyxLQUFLLElBQUlFLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdKLENBQUMsQ0FBQ21GLFdBQUYsQ0FBY3pDLE1BQWxDLEVBQTBDdEMsQ0FBQyxFQUEzQztNQUErQyxLQUFLd0UsY0FBTCxDQUFvQjVFLENBQUMsQ0FBQ21GLFdBQUYsQ0FBYy9FLENBQWQsQ0FBcEIsRUFBc0NGLENBQXRDO0lBQS9DOztJQUNBLEtBQUtFLENBQUMsR0FBRyxDQUFULEVBQVlBLENBQUMsR0FBR0osQ0FBQyxDQUFDb0YsU0FBRixDQUFZMUMsTUFBNUIsRUFBb0N0QyxDQUFDLEVBQXJDO01BQXlDLEtBQUs4RSxTQUFMLENBQWVsRixDQUFDLENBQUNvRixTQUFGLENBQVloRixDQUFaLENBQWYsRUFBK0JGLENBQS9CO0lBQXpDO0VBQ0gsQ0FsSE0sRUFtSFBBLENBQUMsQ0FBQ1csU0FBRixDQUFZa0UsYUFBWixHQUE0QixVQUFTL0UsQ0FBVCxFQUFZRSxDQUFaLEVBQWU7SUFDdkMsS0FBSyxJQUFJRSxDQUFDLEdBQUdKLENBQUMsQ0FBQ3FGLEtBQVYsRUFDTC9FLENBQUMsR0FBRyxDQURKLEVBQ09BLENBQUMsR0FBR0YsQ0FBQyxDQUFDc0MsTUFEYixFQUNxQnBDLENBQUMsRUFEdEIsRUFDMEI7TUFDdEIsSUFBSUMsQ0FBQyxHQUFHSCxDQUFDLENBQUNFLENBQUQsQ0FBVDtNQUNBLEtBQUs0RSxTQUFMLENBQWUzRSxDQUFmLEVBQWtCTCxDQUFsQjtJQUNIO0VBQ0osQ0F6SE0sRUEwSFBBLENBQUMsQ0FBQ2dDLFFBQUYsR0FBYSxJQTFITixFQTJIUGhDLENBM0hBO0FBNEhILENBdklHLENBdUlEbUIsQ0FBQyxXQXZJQSxDQUpKOztBQTRJQWpCLENBQUMsQ0FBQ2dCLFdBQUYsR0FBZ0JLLENBQWhCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdCA9IHJlcXVpcmU7XG52YXIgZSA9IG1vZHVsZTtcbnZhciBvID0gZXhwb3J0cztcbnZhciBhLCBpID0gdGhpcyAmJiB0aGlzLl9fZXh0ZW5kcyB8fCAoYSA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICByZXR1cm4gKGEgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwge1xuICAgICAgICBfX3Byb3RvX186IFtdXG4gICAgfVxuICAgIGluc3RhbmNlb2YgQXJyYXkgJiZcbiAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIHQuX19wcm90b19fID0gZVxuICAgIH0gfHxcbiAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGZvciAodmFyIG8gaW4gZSkgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIG8pICYmICh0W29dID0gZVtvXSlcbiAgICB9KSh0LCBlKVxufSxcbmZ1bmN0aW9uKHQsIGUpIHtcbiAgICBmdW5jdGlvbiBvKCkge1xuICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gdFxuICAgIH1cbiAgICBhKHQsIGUpLFxuICAgIHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAoby5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG8pXG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcIl9fZXNNb2R1bGVcIiwge1xuICAgIHZhbHVlOiAhMFxufSksXG5vLlJlc0NhY2hlTWdyID0gdm9pZCAwO1xudmFyIHIgPSB0KFwiQmFzZU1nclwiKSxcbm4gPSB0KFwiVGltZVV0aWxzXCIpLFxucyA9IHQoXCJVSVV0aWxzXCIpLFxuYyA9IHQoXCJSZXNvdXJjZU1nclwiKSxcbmwgPSBmdW5jdGlvbih0KSB7XG4gICAgZnVuY3Rpb24gZSgpIHtcbiAgICAgICAgdmFyIGUgPSB0LmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgcmV0dXJuIGUudGVtcG9yYXJ5Q2FjaGUgPSBbXSxcbiAgICAgICAgZS5wZXJtYW5lbnRDYWNoZSA9IFtdLFxuICAgICAgICBlLmlzU3RhcnREZWNSZWYgPSAhMSxcbiAgICAgICAgZS5hc3NldHNMaWZlVGltZSA9IDUsXG4gICAgICAgIGUucGVybWFuZW50Q2FjaGVLZXlNYXAgPSBuZXcgTWFwLFxuICAgICAgICBlLmRlcHNkZXBzID0gW10sXG4gICAgICAgIGVcbiAgICB9XG4gICAgcmV0dXJuIGkoZSwgdCksXG4gICAgZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gbnVsbCA9PSB0aGlzLmluc3RhbmNlICYmICh0aGlzLmluc3RhbmNlID0gbmV3IGUpLFxuICAgICAgICB0aGlzLmluc3RhbmNlXG4gICAgfSxcbiAgICBlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3RhcnREZWNSZWYoKVxuICAgIH0sXG4gICAgZS5wcm90b3R5cGUuc3RhcnREZWNSZWYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc1N0YXJ0RGVjUmVmIHx8ICh0aGlzLmlzU3RhcnREZWNSZWYgPSAhMCwgcy5VSVV0aWxzLnNjaGVkdWxlKHRoaXMuYXV0b1JlbGVhc2UsIHRoaXMsIDEpKVxuICAgIH0sXG4gICAgZS5wcm90b3R5cGUuYXV0b1JlbGVhc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZm9yICh2YXIgdCA9IG4uVGltZVV0aWxzLkdldFRpbWVCeVNlY29uZCgpLCBlID0gMDsgZSA8IHRoaXMudGVtcG9yYXJ5Q2FjaGUubGVuZ3RoOyBlKyspIHtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy50ZW1wb3JhcnlDYWNoZVtlXTtcbiAgICAgICAgICAgIGlmIChvICYmIHQgLSBvLnJlbGVhc2VUaW1lID49IG8uY2FjaGVUaW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKG8uZGVmQ291bnQgPD0gMCkgY29udGludWU7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9IG8uZGVmQ291bnQsXG4gICAgICAgICAgICAgICAgaSA9IDA7IGkgPCBhOyBpKyspIGlmIChvLmFzc2V0LmRlY1JlZigpLCBvLmFzc2V0LnJlZkNvdW50IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZW1wb3JhcnlDYWNoZS5zcGxpY2UoZSwgMSksXG4gICAgICAgICAgICAgICAgICAgIGUtLSxcbiAgICAgICAgICAgICAgICAgICAgby5kZWZDb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG8uYXNzZXQucmVmQ291bnQgPiAwICYmIChvLnJlbGVhc2VUaW1lID0gbi5UaW1lVXRpbHMuR2V0VGltZUJ5U2Vjb25kKCkgKyA4NjQwMClcbiAgICAgICAgICAgIH0gZWxzZSBvICYmIDAgPT0gby5hc3NldC5yZWZDb3VudCAmJiAodGhpcy50ZW1wb3JhcnlDYWNoZS5zcGxpY2UoZSwgMSksIGUtLSwgby5kZWZDb3VudCA9IDApXG4gICAgICAgIH1cbiAgICB9LFxuICAgIGUucHJvdG90eXBlLnJlZnJlc2hUaW1lID0gZnVuY3Rpb24odCkge1xuICAgICAgICBmb3IgKHZhciBlID0gbi5UaW1lVXRpbHMuR2V0VGltZUJ5U2Vjb25kKCksIG8gPSAwOyBvIDwgdC5sZW5ndGg7IG8rKykgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLnRlbXBvcmFyeUNhY2hlLmxlbmd0aDsgYSsrKSB7XG4gICAgICAgICAgICB2YXIgaSA9IHRbb10sXG4gICAgICAgICAgICByID0gdGhpcy50ZW1wb3JhcnlDYWNoZVthXTtcbiAgICAgICAgICAgIGlmIChpLmNhY2hla2V5ID09IHIuY2FjaGVrZXkgJiYgaS50eXBlID09IHIudHlwZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudGVtcG9yYXJ5Q2FjaGVbYV0ucmVsZWFzZVRpbWUgPSBlLFxuICAgICAgICAgICAgICAgIHRoaXMudGVtcG9yYXJ5Q2FjaGVbYV0uZGVmQ291bnQgKz0gaS5kZWZDb3VudCxcbiAgICAgICAgICAgICAgICB0aGlzLnRlbXBvcmFyeUNhY2hlW2FdLmNhblJlbGVhc2UgPSAhMTtcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICBlLnByb3RvdHlwZS5hZGRBc3NldHMgPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGlmICh0ICYmIHQuYXNzZXQpIHtcbiAgICAgICAgICAgIHZhciBvID0gZSA/IHRoaXMudGVtcG9yYXJ5Q2FjaGU6IHRoaXMucGVybWFuZW50Q2FjaGUsXG4gICAgICAgICAgICBhID0gdGhpcy5pc0V4aXN0S2V5KHQuY2FjaGVrZXksIHQudHlwZSwgbyk7IC0gMSA9PSBhID8gby5wdXNoKHQpIDogb1thXSA9IHRcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZS5wcm90b3R5cGUuYWRkQXNzZXRLZXlUb01hcCA9IGZ1bmN0aW9uKHQsIGUsIG8sIGEpIHtcbiAgICAgICAgdmFyIGkgPSB0aGlzLnBlcm1hbmVudENhY2hlS2V5TWFwLmdldCh0KSxcbiAgICAgICAgciA9IG5ldyBjLlJlc0NhY2hlS2V5KGUsIG8sIGEpO1xuICAgICAgICBpZiAoaSAmJiBpLmxlbmd0aCA+IDApIGkucHVzaChyKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgbiA9IFtdO1xuICAgICAgICAgICAgbi5wdXNoKHIpLFxuICAgICAgICAgICAgdGhpcy5wZXJtYW5lbnRDYWNoZUtleU1hcC5zZXQodCwgbilcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZS5wcm90b3R5cGUucmVsZWFzZUFzc2V0c0Zyb21NYXAgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIHZhciBlID0gdGhpcy5wZXJtYW5lbnRDYWNoZUtleU1hcC5nZXQodCk7XG4gICAgICAgIGlmIChlICYmIGUubGVuZ3RoID4gMCkgZm9yICh2YXIgbyA9IDA7IG8gPCBlLmxlbmd0aDsgbysrKSBmb3IgKHZhciBhID0gMDsgYSA8IHRoaXMucGVybWFuZW50Q2FjaGUubGVuZ3RoOyBhKyspIHtcbiAgICAgICAgICAgIHZhciBpID0gdGhpcy5wZXJtYW5lbnRDYWNoZVthXTtcbiAgICAgICAgICAgIGlmIChpICYmIGkuY2FjaGVrZXkgPT0gZVtvXS5jYWNoZWtleSAmJiBpLnR5cGUgPT0gZVtvXS50eXBlKSB7XG4gICAgICAgICAgICAgICAgaS5hc3NldC5kZWNSZWYoKSxcbiAgICAgICAgICAgICAgICBpLmFzc2V0LnJlZkNvdW50IDw9IDAgJiYgKHRoaXMucGVybWFuZW50Q2FjaGUuc3BsaWNlKGEsIDEpLCBhLS0pO1xuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGUucHJvdG90eXBlLmdldEFzc2V0cyA9IGZ1bmN0aW9uKHQsIGUsIG8pIHtcbiAgICAgICAgdmFyIGEgPSBcIlwiO1xuICAgICAgICBvICYmIChhID0gY2MuanMuZ2V0Q2xhc3NOYW1lKG8pKTtcbiAgICAgICAgdmFyIGksIHIgPSBuLlRpbWVVdGlscy5HZXRUaW1lQnlTZWNvbmQoKSxcbiAgICAgICAgcyA9IHIgKyA4NjQwMCxcbiAgICAgICAgYyA9IHQgKyBcIi9cIiArIGUsXG4gICAgICAgIGwgPSB0aGlzLmlzRXhpc3RLZXkoYywgYSwgdGhpcy50ZW1wb3JhcnlDYWNoZSksXG4gICAgICAgIHUgPSB0aGlzLmlzRXhpc3RLZXkoYywgYSwgdGhpcy5wZXJtYW5lbnRDYWNoZSksXG4gICAgICAgIHAgPSBudWxsLFxuICAgICAgICBnID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIC0gMSAhPSBsICYmICh0aGlzLnRlbXBvcmFyeUNhY2hlW2xdLnJlbGVhc2VUaW1lID0gcywgdGhpcy50ZW1wb3JhcnlDYWNoZVtsXS5jcmVhdGVUaW1lID0gciwgdGhpcy50ZW1wb3JhcnlDYWNoZVtsXS5jYW5SZWxlYXNlID0gITAsIChpID0gdGhpcy50ZW1wb3JhcnlDYWNoZVtsXS5hc3NldCkgJiYgaS5yZWZDb3VudCA+IDAgJiYgKHAgPSB0aGlzLnRlbXBvcmFyeUNhY2hlW2xdKSksXG4gICAgICAgIC0xICE9IHUgJiYgKHRoaXMucGVybWFuZW50Q2FjaGVbdV0ucmVsZWFzZVRpbWUgPSBzLCB0aGlzLnBlcm1hbmVudENhY2hlW3VdLmNyZWF0ZVRpbWUgPSByLCB0aGlzLnBlcm1hbmVudENhY2hlW3VdLmNhblJlbGVhc2UgPSAhMCwgKGkgPSB0aGlzLnBlcm1hbmVudENhY2hlW3VdLmFzc2V0KSAmJiBpLnJlZkNvdW50ID4gMCAmJiAoZyA9IHRoaXMucGVybWFuZW50Q2FjaGVbdV0pKSxcbiAgICAgICAgcCB8fCBnIHx8IG51bGxcbiAgICB9LFxuICAgIGUucHJvdG90eXBlLmlzRXhpc3RLZXkgPSBmdW5jdGlvbih0LCBlLCBvKSB7XG4gICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgby5sZW5ndGg7IGErKykge1xuICAgICAgICAgICAgdmFyIGkgPSBvW2FdO1xuICAgICAgICAgICAgaWYgKGkgJiYgaS5jYWNoZWtleSA9PSB0ICYmIGkudHlwZSA9PSBlKSByZXR1cm4gYVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAtIDFcbiAgICB9LFxuICAgIGUucHJvdG90eXBlLnZpc2l0QXNzZXQgPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGlmICh0Ll91dWlkKSBlLnB1c2godC5fdXVpZCk7XG4gICAgICAgIGVsc2UgaWYgKHQgaW5zdGFuY2VvZiBjYy5TcHJpdGVGcmFtZSkge1xuICAgICAgICAgICAgdmFyIG8sIGEgPSB0O1xuICAgICAgICAgICAgYS5fb3JpZ2luYWwgPyAobyA9IGEuX29yaWdpbmFsLl90ZXh0dXJlKSAmJiBlLnB1c2goby5fdXVpZCkgOiAobyA9IGEuZ2V0VGV4dHVyZSgpKSAmJiBlLnB1c2goby5fdXVpZClcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZS5wcm90b3R5cGUudmlzaXRDb21wb25lbnQgPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGZvciAodmFyIG8gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0KSwgYSA9IDA7IGEgPCBvLmxlbmd0aDsgYSsrKSB7XG4gICAgICAgICAgICB2YXIgaSA9IG9bYV07XG4gICAgICAgICAgICBpZiAoXCJub2RlXCIgIT09IGkgJiYgXCJfX2V2ZW50VGFyZ2V0c1wiICE9PSBpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHIgPSB0W2ldO1xuICAgICAgICAgICAgICAgIGlmIChyIGluc3RhbmNlb2YgY2MuTm9kZVBvb2wpIHRoaXMudmlzaXROb2RlUG9vbChyLCBlKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChcIm9iamVjdFwiID09IHR5cGVvZiByICYmIHIpIGlmIChBcnJheS5pc0FycmF5KHIpKSBmb3IgKHZhciBuID0gMDsgbiA8IHIubGVuZ3RoOyBuKyspKGMgPSByW25dKSBpbnN0YW5jZW9mIGNjLkFzc2V0ICYmIHRoaXMudmlzaXRBc3NldChjLCBlKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyLmNvbnN0cnVjdG9yICYmIHIuY29uc3RydWN0b3IgIT09IE9iamVjdCkgciBpbnN0YW5jZW9mIGNjLkFzc2V0ICYmIHRoaXMudmlzaXRBc3NldChyLCBlKTtcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhyKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChuID0gMDsgbiA8IHMubGVuZ3RoOyBuKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjOyAoYyA9IHJbc1tuXV0pIGluc3RhbmNlb2YgY2MuQXNzZXQgJiYgdGhpcy52aXNpdEFzc2V0KGMsIGUpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGUucHJvdG90eXBlLnZpc2l0Tm9kZSA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgZm9yICh2YXIgbyA9IDA7IG8gPCB0Ll9jb21wb25lbnRzLmxlbmd0aDsgbysrKSB0aGlzLnZpc2l0Q29tcG9uZW50KHQuX2NvbXBvbmVudHNbb10sIGUpO1xuICAgICAgICBmb3IgKG8gPSAwOyBvIDwgdC5fY2hpbGRyZW4ubGVuZ3RoOyBvKyspIHRoaXMudmlzaXROb2RlKHQuX2NoaWxkcmVuW29dLCBlKVxuICAgIH0sXG4gICAgZS5wcm90b3R5cGUudmlzaXROb2RlUG9vbCA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgZm9yICh2YXIgbyA9IHQuX3Bvb2wsXG4gICAgICAgIGEgPSAwOyBhIDwgby5sZW5ndGg7IGErKykge1xuICAgICAgICAgICAgdmFyIGkgPSBvW2FdO1xuICAgICAgICAgICAgdGhpcy52aXNpdE5vZGUoaSwgZSlcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZS5pbnN0YW5jZSA9IG51bGwsXG4gICAgZVxufSAoci5kZWZhdWx0KTtcbm8uUmVzQ2FjaGVNZ3IgPSBsIl19